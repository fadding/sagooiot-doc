# OTA 升级

## OTA 介绍

OTA（Over-the-Air Technology）即空中下载技术，是指通过无线网
络（如蜂窝网络、WIFI、蓝牙等）对设备进行远程升级的技术。在物联网中，OTA
技术可以用于对设备的固件、配置文件、应用程序等进行远程升级。本平台暂时支持两种升级方式：mqtt升级和http升级。详细内容见下文。


## 使用限制
使用OTA功能的设备必须使用MQTT协议接入物联网平台，设备可以选择MQTT协议或HTTPS协议下载升级包。

升级包的数量、大小、格式限制。

HTTPS协议下载：可以包括一个或多个文件，单个文件最大为1,000 MB。仅支持.bin、.dav、.tar、.gz、.zip、.gzip、.apk、.tar.gz、.tar.xz、.pack格式的文件。

以上限制可以在`系统配置--》参数管理`中进行修改。

## 运行原理

OTA升级运行原理如下图所示：

![ota.png](../../public/imgs/guide/operate/ota.png)

在OTA升级服务中，按照以下模式运行：

- 设备上报版本号 将设备接入物联网平台，通过初始化和配置OTA功能，使设备能在首次升级前上报版本号，确保顺利进行功能更新和性能优化。
- 推送升级包信息 通过为设备添加OTA模块和升级包，用户可以定义不同可升级模块（如固件、软件、驱动），并选择完整的升级文件或差分升级方式，实现对设备的功能更新和性能优化。用户可选择验证升级包，确保升级成功后再进行批量升级。
- 设备下载升级包 设备通过HTTPS或MQTT协议获取升级包信息，并下载相应升级包，同时上报版本号和升级进度至SagooIOT物联网平台。
- 查看升级结果 通过查看设备升级状态和升级包信息，用户可以了解目标设备的升级情况，包括版本分布和成功率统计，从而分析OTA升级失败原因并提升设备升级成功率。

## 升级步骤

![process.png](../../public/imgs/guide/operate/process.png)

注：文件下载方式现在只支持Https协议，MQTT协议暂不支持。

## 操作步骤

**新增升级包**

点击"添加升级包”，打开“新增升级包”弹窗。

![添加升级包](../../public/imgs/guide/operate/add.png)


| 参数名称       | 描述                                                         |
| -------------- | ------------------------------------------------------------ |
| 升级包类型     | 必选单选框，是对类型进行定义。目前有整包和差分两种类型。<br />整包升级包包含完整的升级文件，直接推送给设备进行升级。<br />差分升级包仅包含新版本与之前版本的不同之处，<br/>仅发送差异部分至设备，设备进行差分还原后再升级，有效减少资源占用和流量消耗。 |
| 升级包名称     | 必填输入框，是对升级包名称进行定义。                         |
| 所属产品       | 必填下拉框，是对所属产品进行定义。                           |
| 升级包模块     | 必选下拉框，是对升级包模块进行定义。                         |
| 升级包版本号   | 必填输入框，是对升级包版本号进行定义。                       |
| 算法签名       | 必选下拉框，是对算法签名进行定义，支持MD5和SHA256算法。      |
| 选择升级包     | 选择上传的升级包，支持的格式有`.bin`、`.dav`、`.tar`、`.gz`、`.zip`、<br/>`.gzip`、`.apk`、`.tar.gz`、`.tar.xz`、`.pack`。 |
| 升级包是否验证 | 必选单选框，是对升级包是否验证进行定义。                     |
| 升级包描述     | 非必填输入框，是对当前新增的升级包进行描述。                 |


### **升级包验证**

![verify.png](../../public/imgs/guide/operate/verify.png)

| 参数名称     | 描述                                                         |
| ------------ | ------------------------------------------------------------ |
| 类型         | 必填单选，限制操作升级包为验证或升级                         |
| 批次名称     | 必填输入框，限制字符为，是对批次名称进行定义。               |
| 待升级版本号 | 必填输入框，限制字符为，是对模块名称进行定义。               |
| 协议方式     | 必选单选，是对协议方式进行定义，目前有http、https、mqtt三种方式。设备端收到物联网平台推送的升级包下载信息后，通过此处设置的协议下载升级包。 |
| 升级方式     | 必选单选，是对升级方式进行定义，目前有静态升级与动态升级两种方式。（暂时只支持静态升级） |
| 主动推送     | 不选单选，是对是否主动推送进行定义。                         |
| 所属设备     | 必选多选，如选择mqtt协议时，选择所需                         |

### 执行结果

在升级包列表页签，找到状态为验证中升级包，单击对应的查看按钮。单击升级包信息页签，可查看验证进度。

![result.png](../../public/imgs/guide/operate/result.png)

### **添加模块**

点击"添加升级包”，打开“新增模块”弹窗。

![module.png](../../public/imgs/guide/operate/module.png)

| 参数名称 | 描述                                           |
| -------- | ---------------------------------------------- |
| 所属产品 | 必填下拉框，是对所属产品进行定义。             |
| 模块名称 | 必填输入框，限制字符为，是对模块名称进行定义。 |
| 模块别名 | 非必填输入框，是对模块别名进行定义。           |
| 模块描述 | 非必填输入框，是对当前新增的升级包进行描述。   |



## 升级方式

### mqtt方式

参考[mqtt协议-OTA相关部分](/develop/protocol/mqtt.md)

### http方式


参考[http协议-OTA相关部分](/develop/protocol/http.md)

